#!/usr/bin/env python
import json
import subprocess




def main():
    
    cache_configs = {'cudaFuncCachePreferShared' : 1, 'cudaFuncCachePreferL1' : 2,  'cudaFuncCachePreferEqual' : 3}
    N = 32*3

    try:
        subprocess.call(["make", "N={}".format(N), "CACHE_CONFIG={}".format(cache_configs['cudaFuncCachePreferL1'])])
        output = subprocess.check_output(["./mat_mult"])
        print "output: {}".format(output)

        subprocess.call(["make", "clean"])

    except subprocess.CalledProcessError:
        print "benchmark error (matrix multiplication exited with non-zero value)"

if __name__ == "__main__":
    main()
